---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - First author
  - Another author
thanks: "Code and data are available at: https://github.com/hannahyu07/US-Election"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(palmerpenguins)
library(here)
library(rstanarm)
library(modelsummary)
library(ggplot2)
library(knitr)
library(marginaleffects)
library(plotly)
library(tibble)
library(margins)

```


# Introduction
Four years ago, the United States once again was at the forefront of an important electoral contest between the Democratic and Republican parties in the 2020 presidential election. The Democratic and Republican parties are represented by Donald Trump and Joe Biden respectively. Donald Trump achieved a remarkable victory in the 2016 election against Hillary Clinton. His winning was surprising and it led people to challenge the preconceived notions and reliability of pre-election polling data [citation needed]. On the other hand, Joe Biden, the former vice-president under Barack Obama's administration from 2008 to 2016, led the Democratic campaign [citation needed]. He aimed to regain control from the Republican party. In the end, Biden won the election by 51.3% majority votes [citation needed]. It is important for us to understand how various demographic, economic, and social factors may influence individuals' voting decisions, which is why we decide to analyze the 2020 election data set and build a prediction model. This allows us to discover trends and address potential issues in society to better reflect the needs and preferences of diverse communities. 

In this paper, a logistic regression model is used to forecast the outcome of the 2020 election, with data from the Cooperative Election Study (CES)  [citation needed]. Logistic regression is a great choice since it is used to predict binary outcomes, such as election results (Trump or Biden). Our analysis focuses on estimating the likelihood of victory for either Trump or Biden, based on various demographic, geographic, and socioeconomic factors captured in the CES data set, which are race, region that they live, and employment status. 

**addï¼š 4) what was done; 5) what was found after we finish the results section

This report consists of four sections, not including the introduction. In Section 2, we look at the data used for our report and include some tables and graphs to illustrate the different groups of people in our data. In section 3, we build the model and discuss its justification and explanation. The results of our predictions is highlighted in the Section 4 using tables and graphs. Lastly, discussions are conducted based on the findings, which addresses the voting prediction results based on race, region, and employment status. 

In this report, R statistical programming language is used, with R packages: [a lot of citations needed]

## Estimand



# Data {#sec-data}



## Data Measurement



## Summary Statistics



Some of our data is of penguins (@fig-bills), from @palmerpenguins.

```{r}
# read in data
ces2020 <-  read_csv(here::here("data/analysis_data/cleaned_ces2020.csv"))
```

```{r}
# change column type to factor
ces2020 <-
  ces2020 |>
  mutate(
    voted_for = as_factor(voted_for),
    race = factor(
      race,
      levels = c(
        "White",
        "Black",
        "Hispanic",
        "Asian",
        "Native American",
        "Middle Eastern",
        "Two or more races",
        "Other"
      )
    ),
    region = factor(
      region,
      levels = c(
        "Northeast",
        "Midwest",
        "South",
        "West"
      )
    ),
    employ = factor(
      employ,
      levels = c(
        "Full-time",
        "Part-time",
        "Temporarily laid off",
        "Unemployed",
        "Retired",
        "Permanently disabled",
        "Homemaker",
        "Student",
        "Other"
      )
    )
  ) |>
  select(voted_for, race, region, employ)
```


# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in 

[Appendix -@sec-model-details].

## Model set-up

In our analysis, we utilized a Bayesian logistic regression model to examine the relationship between voter preferences and various demographic and socioeconomic factors. The model is formulated as follows:

\begin{align} 
y_i|\pi_i &\sim \mbox{Bern}(\pi_i) \\
\mbox{logit}(\pi_i) &= \alpha + \beta_1 \times \mbox{race}_i + \beta_2 \times \mbox{region}_i + \beta_3 \times \mbox{employ}_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta_1 &\sim \mbox{Normal}(0, 2.5) \\
\beta_2 &\sim \mbox{Normal}(0, 2.5)
\end{align}

In this model, $y_i$ represents the binary outcome variable indicating whether an individual voted Biden (as opposed to Trump). The probability of voting for the Biden ($\pi_i$) is modeled using a logistic link function (\text{logit}($\pi_i$)), which is a linear combination of the intercept ($\alpha$) and the coefficients ($\beta_1$, $\beta_2$, $\beta_3$)) corresponding to the predictor variables race, region, and employment status, respectively. These predictor variables are denoted as \text{race}_i, \text{region}_i, and \text{employ}_i, where $i$ indexes the individuals in the dataset.

The intercept ($\alpha$) and coefficients ($\beta_1$, $\beta_2$, $\beta_3$) are assigned informative prior distributions to regularize the model. Specifically, we assume a normal distribution with a mean of 0 and a standard deviation of 2.5 for each parameter.

We chose this modeling approach for several reasons. Firstly, logistic regression is well-suited for binary outcome variables, making it appropriate for analyzing voting behavior. Additionally, Bayesian methods allow us to incorporate prior knowledge and uncertainty into our analysis, providing more robust estimates of the model parameters.

Alternative modeling approaches, such as linear regression models, were also considered. However, we chose Bayesian logistic regression because our result is a binary variable of voter's decision.

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`. Rstanarm employs Markov chain Monte Carlo (MCMC) techniques to estimate the posterior distribution of the parameters. To avoid exessive runtime, we randomly sampled 1000 observations to fit the model.Model diagnostics, including convergence checks and posterior summaries, are available in the supplementary materials (see Appendix A).


### Model justification

We expect a positive relationship between individuals of Black, Asian, and Hispanic ethnicities and support for Biden. This expectation arises from Trump's history of spreading polarizing language and anti-immigrant sentiments, as well as his controversial plans such as building a border wall. These groups are more likely to align with Biden's policies, which prioritize inclusivity and diversity. White individuals with traditional family values and conservative leanings tend to support Trump. They are drawn to his emphasis on preserving traditional values and promises to uphold conservative principles, especially regarding immigration, law and order, and gun rights.

Conversely, we anticipate a negative relationship between voters in the South and Midwest regions and support for Biden. These regions have a stronger conservative presence and a history of supporting Republican candidates like Trump. States such as Texas and Florida, which are known Republican strongholds, are located in the South. Therefore, individuals in these regions may be less inclined to support Biden's progressive agenda.

Regarding employment status, we expect students, unemployed individuals, and those temporarily laid off to be more inclined to support Biden. Students are often exposed to diverse perspectives and progressive ideas in educational settings, making them more likely to endorse Biden's platform. Unemployed and laid-off individuals may favor Biden due to the Democratic Party's advocacy for social welfare programs and support for workers' rights.

The voting behavior of employed individuals is harder to distinguish. Some working individuals support Trump due to their opposition to higher taxes and prefer his promises of tax cuts and economic deregulation. Conversely, others lean towards Biden because they believe tax increases should primarily target the wealthy and not burden the middle class.
Additionally, educated and liberal-leaning working professionals may prioritize issues such as healthcare, climate change, and social justice, aligning them with Biden's platform. 


-------------------------------needs some explanation
```{r}
# We could use posterior predictive checks, introduced in Section 12.4, to show that the logistic regression approach is a good choice for this circumstance.
political_preferences1 <-
  readRDS(file = here::here("models/political_preferences1.rds"))

pp_check(political_preferences1) +
  theme(legend.position = "bottom")
```


# Results

## Data Result
@fig-race_region shows the relationship between race, region, and voting preference. In the Northeast, Midwest, and West regions of the United States, there is a consistent pattern where individuals across almost all racial groups tend to show greater support for Biden over Trump. Conversely, in the South, there is a distinct divide, with White individuals predominantly favoring Trump, while almost all other racial groups support Biden more than Trump. Overall, the four subplots all illustrate that among Black, Asian, and Hispanic communities, the proportion of support for Biden exceeds that for Trump. However, it is evident that White individuals constitute a significantly larger portion of the population compared to other racial groups, thereby exerting a greater influence on voting outcomes.
```{r}
#| label: fig-race_region
#| fig-cap: The distribution of presidential preferences, by region and race
#| echo: false

ces2020 |>
  ggplot(aes(x = race, fill = voted_for)) +
  stat_count(position = "dodge") +
  facet_wrap(facets = vars(region)) +
  theme_minimal() +
  labs(
    x = "Race",
    y = "Number of respondents",
    fill = "Voted for"
  ) +
  coord_flip() +
  scale_fill_brewer(palette = "Set1") +
  theme(legend.position = "bottom")
```
@fig-race_employ illustrates the relationship between region, employment status, and voting preferences for Trump and Biden. Across all regions, people in full-time and part-time employment show a greater percentage of support for Biden than to Trump. Among retired people, support for Trump and Biden is roughly comparable: with a slight tilt towards Biden in the Northeast, Midwest, and West, and towards Trump in the South. In addition, people with other employment statuses generally favor Biden over Trump, except for certain group (Homemaker) in the South.

```{r}
#| label: fig-race_employ
#| fig-cap: The distribution of presidential preferences, by region and employment status
#| echo: false

ces2020 |>
  ggplot(aes(x = employ, fill = voted_for)) +
  stat_count(position = "dodge") +
  facet_wrap(facets = vars(region)) +
  theme_minimal() +
  labs(
    x = "Employment status",
    y = "Number of respondents",
    fill = "Voted for"
  ) +
  coord_flip() +
  scale_fill_brewer(palette = "Set1") +
  theme(legend.position = "bottom")
```

```{r}
# #| label: fig-race_employ_white
# #| fig-cap: The distribution of presidential preferences, by region and employment status, only white people
# #| echo: false
# 
# ces2020_selected_data <- ces2020[ces2020$race == "White", ]
# 
# ces2020_selected_data |>
#   ggplot(aes(x = employ, fill = voted_for)) +
#   stat_count(position = "dodge") +
#   facet_wrap(facets = vars(region)) +
#   theme_minimal() +
#   labs(
#     x = "Employment status",
#     y = "Number of respondents",
#     fill = "Voted for"
#   ) +
#   coord_flip() +
#   scale_fill_brewer(palette = "Set1") +
#   theme(legend.position = "bottom")
```


This bubble plot illustrates four variables: race, region, employment status, and voting preference. Darker dots indicate a higher number of people, with red representing Trump supporters and blue for Biden supporters. Purple dots suggest similar support rates for both candidates, since blue and red makes purple in a 1:1 ratio. We can see that the darker dots are mostly in White, Black, Hispanic communities for full-time, part-time, or retired individuals. The darker dots are all blue, which indicates stronger support for Biden. It can also be noted that there are very few entirely red dots, which means that there is no significant disparities in voting percentages between Trump and Biden even among those groups which partially supported Trump. In those purple dots, we found that mostly are from people who are either Native American or from the South.
```{r}
#| label: fig-race_employ_region
#| fig-cap: The distribution of presidential preferences, by race, region and employment status
#| echo: false


plot_ly(x=ces2020$race, y=ces2020$region, z=ces2020$employ, colors = c("red", "blue")) %>% 
  add_markers(color = ces2020$voted_for, opacity = 0.03, size = 0.4) %>%
  layout(xaxis = list(title = 'Race'), yaxis = list(title = 'Region'), zaxis = list(title = 'Employment Status')) %>%
  layout(xaxis = list(titlefont = list(size = 22), tickfont = list(size = 22)),
         yaxis = list(titlefont = list(size = 22), tickfont = list(size = 22)),
         zaxis = list(titlefont = list(size = 22), tickfont = list(size = 22)))
```


## Model Results

```{r prediction, echo=F, warning=F, message=F}

# # generate predictions for each of our grouped cells
# props$estimate <- predict.glm(political_preferences1, newdata = props,
#                           type = "response")
# 
# # create a new column with number of voters from each cell voting Biden
# props <- props %>% mutate(num_voters = n*estimate)
# 
# # get errors for our prediction
# errors <- predict.glm(model, newdata = props,
#                       type = "response", se.fit = T)
# lower <- errors$fit - errors$se.fit
# upper <- errors$fit + errors$se.fit
# 
# 
# # combine the proportions and the errors we generated
# props_error <- cbind(props, lower, upper)
# props_error <- props_error %>% 
#   rename("lower" = ...11,
#          "upper" = ...12)
# 
# # create a new column with number of voters from each cell voting Biden
# props_error <- props_error %>% mutate(num_voters_lower = n*lower,
#                                 num_voters_upper = n*upper)
# 
# # create a new dataset which contains upper and lower estimates for proportions
# # of votes for each state
# voting_biden <- props_error %>% mutate(biden_predict_prop=estimate*prop,
#                                        biden_predict_prop_lower = lower*prop,
#                                        biden_predict_prop_upper = upper*prop) %>%
#   group_by(stateicp) %>%
#   summarise(biden_predict = sum(biden_predict_prop),
#             biden_predict_lower = sum(biden_predict_prop_lower),
#             biden_predict_upper = sum(biden_predict_prop_upper))
```

```{r stateplot, echo=F, message=F, warning=F, fig.cap="Proportion of each State Voting for Biden"}
# # get state by state proportions for our polling data
# polling_props <- polling %>% 
#   group_by(stateicp, vote_biden) %>% 
#   summarise(n = n()) %>% 
#   mutate(prop = n/sum(n)) 
# 
# # combine the polling data proportions with the post-stratification data
# poll_post_biden <- inner_join(polling_props, voting_biden, by = "stateicp")
# poll_post_biden <- poll_post_biden %>% 
#   filter(vote_biden == 1)
# 
# # plot for predictions
# 
# poll_post_biden %>% 
#   ggplot(aes(x = employ, y = biden_predict)) +
#   geom_point(aes(color = "black")) +
#   geom_line(aes(group = 1)) +
#   scale_y_continuous(labels = scales::percent) +
#   theme(axis.text.x = element_text(angle = 70, size = 6, hjust = 1)) +
#   geom_ribbon(aes(group = 1, ymin=biden_predict_lower, ymax=biden_predict_upper), 
#               alpha = 0.2, fill = "red") +
#   geom_line(data = poll_post_biden, aes(x=stateicp, y=prop, group = 2), 
#             linetype = "twodash") +
#   geom_point(data = poll_post_biden, aes(x=stateicp, y=prop, colour = "red")) +
#   geom_hline(aes(yintercept = 0.5), alpha = 0.5) +
#   scale_color_discrete(name = "Data", labels = c("Population", "Sample")) +
#   labs(title = "Proportion of People voting for Joe Biden by State",
#        x = "State", y = "Percentage Voting Biden")
```




Our results are summarized in @tbl-modelresults.

```{r}

# # Marginal Effect 
# political_preferences_predictions <- predictions(political_preferences1) |>
#   as_tibble()
# 
# political_preferences_predictions

```


```{r}
# library(margins)
# 
# # Marginal effects for each predictor variable
# marginal_effects <- margins(political_preferences1)
# 
# # Plotting marginal effects for race
# race_effects <- dyplot(marginal_effects, variables = "race")
# race_effects
# 
# # Plotting marginal effects for region
# region_effects <- dyplot(marginal_effects, variables = "region")
# region_effects
# 
# # Plotting marginal effects for employ
# employ_effects <- dyplot(marginal_effects, variables = "employ")
# employ_effects

```



```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: tbl-modelresults1
#| tbl-cap: "Explanatory models Political Preferences (n = 1000)"

political_preferences1 <-
  readRDS(file = here::here("models/political_preferences1.rds"))

# Change variable names directly in the model object
names(political_preferences1$coefficients) <- c(
  "Intercept", "Black", "Hispanic", "Middle Eastern", "Native American", 
  "Other race", "Two or more races", "White", "Northeast", "South", "West",
  "Homemaker", "Other employment", "Part-time", "Permanently disabled", 
  "Retired", "Student", "Temporarily laid off", "Unemployed"
)


modelsummary(
  list(
    "Support Biden" = political_preferences1
  ),
  statistic = "mad"
  )
```
Our results generally matches our justification. To avoid multicollinearity, the model excluded three variables from each category: race Asian, region Midwest, and employed full-time.The intercept represents the estimated log-odds of supporting Biden when all other predictors are held constant at their reference levels. In this case, the estimated log-odds of supporting Biden for individuals who are Asian, live in the Midwest, and are employed full-time is 0.806. 

Black individual's support for Biden is large. The estimated coefficient of 2.549 suggests that, holding all other variables constant, Black individuals are estimated to have a 2.549 unit increase in the log-odds of supporting Biden compared to the reference group. Hispanic races on average are also more likely to vote for Biden. We observe an outlier, individuals with race "other" has a 37.999 higher log-odds of supporting Biden compared to the reference group. 

Voters preference for candidates also vary by regions and their employment status. Biden has more supports in the Northeast and West region while Trump gains a majority of his votes from the South. As anticipated, students exhibit strong support for Biden. Additionally, individuals who are laid off, unemployed, or employed part-time, potentially reliant on social benefits, also prefer for Biden.



```{r}
# # Load required libraries
# library(bayestestR)
# 
# # Extract posterior draws from the model object
# posterior_draws <- as.matrix(political_preferences1)
# 
# # Define the predictor variables for which you want to compute marginal effects
# predictor_variables <- c("Black", "Hispanic", "Middle Eastern", "Native American", 
#                          "Other race", "Two or more races", "White", "Northeast", 
#                          "South", "West", "Homemaker", "Other employment", 
#                          "Part-time", "Permanently disabled", "Retired", 
#                          "Student", "Temporarily laid off", "Unemployed")
# 
# # Compute marginal effects
# marginal_effects <- marginal_effects(posterior_draws, variables = predictor_variables)
# 
# # Summary of marginal effects
# summary(marginal_effects)



```

```{r}
# library(tidybayes)
# 
# # Extract draws from the Bayesian model
# draws <- spread_draws(political_preferences1)
# 
# # Plot the posterior distribution of a predictor variable
# ggplot(draws, aes(x = raceBlack)) +
#   geom_density(fill = "skyblue", color = "black") +
#   labs(x = "Black", y = "Density", title = "Posterior Distribution of Black Variable")

```




```{r}
# Extract posterior samples
# posterior_samples <- as.matrix(political_preferences)
# 
# # Calculate credible intervals (e.g., 95%)
# credible_intervals <- apply(posterior_samples, 2, function(x) quantile(x, c(0.025, 0.975)))
# 
# # Extract coefficient names
# coefficient_names <- colnames(posterior_samples)
# 
# # Create a data frame with coefficient names, coefficient estimates, and credible intervals
# table_data <- data.frame(
#   Posterior_Mean = colMeans(posterior_samples),
#   Credible_Interval_Lower = credible_intervals[1, ],
#   Credible_Interval_Upper = credible_intervals[2, ]
# )
# 
# # Print the table
# print(table_data)


```

Figure # shows range of coefficient estimates of our model within the 90% probability. Due to the fact that the credibility interval for race "Other" is particularly large, we cannot observe the trend of the 90% credibility intervals of other variables. Therefore we created figure # with the x axis limited from -10 to 10. 

Combing figure # and figure #, we observe statistical significance for the coefficient estimates for students, the Northeast region, individuals identifying with two or more races, individuals identifying with "Other" racial category, Native Americans, Black individuals, and the intercept, Asians in the Midwest region who are employed full-time. The estimates are significant if the intervals do not cross 0. The value for the estimates are in log-odds, indicating that if the coefficient is positive, the individual supports Biden, if negative, the individual supports Trump. 


```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: fig-modelresults1
#| fig-cap: "Credible intervals for predictors of support for Biden 1"

modelplot(political_preferences1, conf_level = 0.9) +
  labs(x = "90% credibility interval")
```

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: fig-modelresults2
#| fig-cap: "Credible intervals for predictors of support for Biden 2"
# Create the model plot
model_plot <- modelplot(political_preferences1, conf_level = 0.9)

# Modify the x-axis limits
model_plot + xlim(-5, 5) +  # Adjust the limits as needed
  labs(x = "90% Credibility Interval")

```



# Discussion

## First discussion point {#sec-first-point}

maybe talk about race?

## Regional Variations

Our analysis highlights regional voting variations, with the Northeast, West, and Midwest favoring Biden, while the South supports Trump. These differences stem from diverse cultural, family, religious, and social perspectives.

Biden's support base is concentrated in the Mid-Atlantic states, New England, the West Coast, Southwestern states, and certain regions around the Great Lakes. This support is particularly evident in notable cities within these regions, driven by various factors including liberal ideals and progressive policies. For instance, states like New York and Massachusetts support Biden due to their liberal-leaning populations, diverse demographics, and emphasis on social justices. Similarly, on the West Coast, states such as California and Washington are known for their progressive values and advocacy for issues like environmental conservation and LGBTQ+ rights, contributing to Biden's popularity in these areas. In the Southwest, states like Arizona and Nevada, with growing minority populations and concerns over immigration policies, also show significant support for Biden. Additionally, states around the Great Lakes, including Illinois and Michigan, align with Biden's platform due to their industrial heritage and strong labor unions.

Voters favoring Biden are predominantly concentrated in big cities and large suburban regions, whereas Trump supporters are dispersed across rural areas with lower population density. Consequently, Trump secured victories in 2,588 counties, whereas Biden won over just 551 [@frey_2021]. Even in traditionally Republican states, major urban areas exhibit significant support for Biden. Notable examples include Charlotte, North Carolina; Salt Lake City, Utah; and Nashville and Memphis, Tennessee, among others [@cnn_2020]. 

This trend reflects the impact of diverse demographics, progressive ideologies, and evolving societal norms in urban areas. Here, a mix of cultural diversity, acceptance of progressive values, and socio-economic factors favors Biden's platform. Additionally, urban centers, with their concentration of educational and cultural institutions, often align with Democratic policies on healthcare, climate change, and social justice.

The 2020 election witnessed intriguing shifts in traditionally conservative states, turning them into battlegrounds. For instance, Texas, a Republican stronghold, saw unprecedented Democratic gains, though ultimately remaining red. Notably, the five largest cities in Texasâ€”Houston, San Antonio, Dallas, Austin, and Fort Worthâ€”all backed the Democratic party, marking a significant departure from historical voting patterns [@texas2020]. Similarly, Georgia, a Republican stronghold since 1992, voted for the Democratic party, reflecting evolving demographic and ideological shifts [@georgia2020].

Southern states, such as Alabama, Mississippi, and South Carolina with a large amount of Christian population, strongly adhere to conservative principles. For example, these states have implemented strict anti-abortion law and advocated for tight immigration policies. Furthermore, these states have historically been less supportive of LGBTQ+ rights. As a result, voters in these Southern states typically align with the Republican party represented by Trump, which prioritizes pro-life initiatives and traditional Christian values.


## Third discussion point

maybe talk about employment?

## COVID and Mail-in Ballots

In addition to traditional socio-economic factors like race, region, and employment, the unique circumstances surrounding the COVID-19 pandemic and the widespread use of mail-in ballots significantly influenced voter turnout and led to Biden's election victory. Trump's handling of the pandemic, including his skepticism towards mask-wearing and disagreements with public health guidance, drew many criticism [@pollitz_long_freed_2020]. Many dissatisfied Republican voters voted for Biden instead. 

Mail-in ballots also played a key role in shaping the election landscape. It increased voter participation, particularly among individuals who were reluctant to vote due to logistical constraints or health concerns amid the pandemic. Mail-in voting dynamics intensified as the election progressed. Initially, Trump led in some states, but as mail-in ballots were counted, the tide often turned in favor of Biden. Trump and his supporters raises concerns about fraudulent ballots. This controversy cast doubt on the validity of the election process, fueling Trump's claims of a "rigged" election.

## Weaknesses and next steps

add more weakness about the data, graphs, etc.

One weakness of using a logistic regression model is its inability to predict voting turnout for candidates beyond the Biden or Trump. Expanding the analysis to include other candidates would enhance its comprehensiveness. Furthermore, the reliability of our findings is contingent upon the accuracy of the survey data. Respondents may provide inaccurate or misleading information, intentionally or unintentionally, leading to biased estimates and unreliable predictions. Additionally, missing data (N/As) can introduce further challenges, as logistic regression requires complete data for accurate modeling.




\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]
# 
# pp_check(first_model) +
#   theme_classic() +
#   theme(legend.position = "bottom")
# 
# posterior_vs_prior(first_model) +
#   theme_minimal() +
#   scale_color_brewer(palette = "Set1") +
#   theme(legend.position = "bottom") +
#   coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

# plot(first_model, "trace")
# 
# plot(first_model, "rhat")
```



\newpage


# References


